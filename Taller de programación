#include <stdio.h>
#include <string.h>
#include <ctype.h>
int main() {
    char id[20];
    char nombre[30];
    int stock;
    float precio;
    float ganancias = 0;
    int opcion;
    // ====== REGISTRO DEL PRODUCTO ======
    while (1) {
        int solo_numeros = 1;
        int id_valido = 1;
        printf("Ingrese el ID del producto: ");
        scanf(" %[^\n]", id);
        // Validar que no esté vacío
        if (strlen(id) == 0) {
            printf("Error: el ID no puede estar vacío.\n");
            continue;
        }
        // Verificar si tiene signo
        if (id[0] == '-' || id[0] == '+') {
            printf("Error: el ID no puede tener signo.\n");
            continue;
        }
        // Verificar si contiene solo números o mezcla letras/números
        for (int i = 0; i < strlen(id); i++) {
            if (!isdigit(id[i])) {
                solo_numeros = 0;
                break;
            }
        }
        // Si son solo números, verificar que sea > 0
        if (solo_numeros) {
            int numero = 0;
            for (int i = 0; i < strlen(id); i++) {
                numero = numero * 10 + (id[i] - '0');
            }
            if (numero <= 0) {
                printf("Error: el ID numérico debe ser mayor que 0.\n");
                id_valido = 0;
            }
        }
        if (id_valido)
            break;
    }
    // Validar nombre (solo letras y espacios)
    while (1) {
        int nombre_valido = 1;
        printf("Ingrese el nombre del producto: ");
        scanf(" %[^\n]", nombre);
        if (strlen(nombre) == 0) {
            printf("Error: el nombre no puede estar vacío.\n");
            continue;
        }
        for (int i = 0; i < strlen(nombre); i++) {
            if (isdigit(nombre[i])) {
                nombre_valido = 0;
                break;
            }
        }
        if (!nombre_valido) {
            printf("Error: el nombre no puede contener números.\n");
            continue;
        }
        break;
    }
    // Validar stock
    while (1) {
        printf("Ingrese el stock inicial: ");
        if (scanf("%d", &stock) != 1 || stock <= 0) {
            printf("Error: ingrese un número válido mayor que 0.\n");
            while (getchar() != '\n');
        } else break;
    }
    // Validar precio
    while (1) {
        printf("Ingrese el precio del producto: ");
        if (scanf("%f", &precio) != 1 || precio <= 0) {
            printf("Error: ingrese un número válido mayor que 0.\n");
            while (getchar() != '\n');
        } else break;
    }
    // Mostrar tabla inicial
    printf("\n============================================================\n");
    printf("| ID | Nombre | Stock | Precio\n");
    printf("============================================================\n");
    printf("| %-12s | %-15s | %-15d | \n", id, nombre, stock);
    printf("| | | unidades |$%.2f\n", precio);
    printf("============================================================\n");
    // ====== MENÚ DE OPCIONES ======
    do {
        printf("\n==== MENU DE OPCIONES ====\n");
        printf("1. Vender producto\n");
        printf("2. Reabastecer stock\n");
        printf("3. Consultar información\n");
        printf("4. Ver ganancias\n");
        printf("5. Salir\n");
        printf("Seleccione una opción: ");
        scanf("%d", &opcion);
        // === OPCIÓN 1: Vender ===
        if (opcion == 1) {
            int cantidad;
            printf("Ingrese cantidad a vender: ");
            scanf("%d", &cantidad);
            if (cantidad <= 0) {
                printf("Error: cantidad inválida.\n");
            } else if (cantidad > stock) {
                printf("Error: no hay suficiente stock disponible. Stock actual: %d\n", stock);
            } else {
                stock -= cantidad;
                ganancias += cantidad * precio;
                printf("Venta realizada con éxito.\n");
            }
        }
        // === OPCIÓN 2: Reabastecer ===
        else if (opcion == 2) {
            int agregar;
            printf("Ingrese cantidad a agregar: ");
            scanf("%d", &agregar);
            if (agregar <= 0) {
                printf("Error: cantidad inválida.\n");
            } else {
                stock += agregar;
                printf("Stock actualizado correctamente.\n");
            }
        }
        // === OPCIÓN 3: Mostrar tabla actualizada ===
        else if (opcion == 3) {
            printf("\n============================================================\n");
            printf("| ID | Nombre | Stock | Precio\n");
            printf("============================================================\n");
            printf("| %-12s | %-15s | %-15d | \n", id, nombre, stock);
            printf("| | | unidades |$%.2f\n", precio);
            printf("============================================================\n");
        }
        // === OPCIÓN 4: Mostrar ganancias ===
        else if (opcion == 4) {
            printf("\n=================== GANANCIAS ===================\n");
            printf("Ganancias totales: $%.2f\n", ganancias);
            printf("=================================================\n");
        }
        // === OPCIÓN 5: Salir ===
        else if (opcion == 5) {
            printf("Saliendo del programa...\n");
        }
        else {
            printf("Opción inválida. Intente nuevamente.\n");
        }
    } while (opcion != 5);
    return 0;
}
